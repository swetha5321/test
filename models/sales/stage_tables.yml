version: 2
sources:
  - name: STAGE_TABLES_TEST
    description: testcase for stage tables
    database: MIGRATION_DB
    schema: STAGE_TABLES
    tables:
      - name: OFFLINE_SALES
        description: table_test
        tests:
          - dbt_expectations.expect_table_column_count_to_be_between:
              min_value: 1 
              max_value: 15
          - dbt_expectations.expect_table_column_count_to_equal:
              value: 15
          - dbt_expectations.expect_table_columns_to_contain_set:
              column_list: ["REGION","COUNTRY","ITEM_TYPE","SALES_TYPE","ORDER_PRIORITY","ORDER_ID","ORDER_DATE","SHIP_DATE","UNITS_SOLD","UNITS_PRICE","UNIT_COST","TOTAL_REVENUE","TOTAL_COST","TOTAL_PROFIT","DATE_DIFFERENCE"]
          - dbt_expectations.expect_table_columns_to_match_ordered_list:
              column_list: ["REGION","COUNTRY","ITEM_TYPE","SALES_TYPE","ORDER_PRIORITY","ORDER_DATE","ORDER_ID","SHIP_DATE","UNITS_SOLD","UNITS_PRICE","UNIT_COST","TOTAL_REVENUE","TOTAL_COST","TOTAL_PROFIT","DATE_DIFFERENCE"]
          - dbt_expectations.expect_table_row_count_to_be_between:
              min_value: 1 
              max_value: 550
          - dbt_expectations.expect_table_row_count_to_equal:
              value: 520
          
        columns:
          - name: REGION
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: varchar
              - dbt_expectations.expect_column_value_lengths_to_be_between:
                  min_value: 1 
                  max_value: 30
          - name: COUNTRY
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: varchar
              - dbt_expectations.expect_column_value_lengths_to_be_between:
                  min_value: 1 
                  max_value: 30
          - name: ITEM_TYPE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: varchar
              - dbt_expectations.expect_column_values_to_be_in_set:
                  value_set: [Cosmetics, Baby Food, Cereal, Fruits, Clothes, Vegetables, Snacks, Beverages, Meat, Office Supplies,Household,Personal Care]
              - dbt_expectations.expect_column_value_lengths_to_be_between:
                  min_value: 1 
                  max_value: 30
          - name: SALES_TYPE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: varchar
              - dbt_expectations.expect_column_values_to_be_in_set:
                  value_set: [Offline, Online]
          - name: ORDER_PRIORITY
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: varchar
              - dbt_expectations.expect_column_values_to_be_in_set:
                  value_set: [C,H,M,L]
              - dbt_expectations.expect_column_value_lengths_to_equal:
                  value: 1
          - name: ORDER_ID
            description: column_test
            tests:
              - dbt_expectations.expect_column_to_exist
              - unique
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: NUMBER
              - dbt_expectations.expect_column_values_to_be_between:
                  min_value: 1  
                  max_value: 150000
              - dbt_expectations.expect_column_values_to_be_increasing
          - name: ORDER_DATE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: date
              - dbt_expectations.expect_column_values_to_match_regex:
                  regex: "/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/"
          - name: SHIP_DATE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: date
              - dbt_expectations.expect_column_values_to_match_regex:
                  regex: "/^[0-9]{4}\/[0-9]{1,2}\/[0-9]{1,2}$/"
          - name: UNITS_SOLD
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: number
              - positive
          - name: UNITS_PRICE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: float
              - positive
          - name: UNIT_COST
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: float
              - positive
          - name: TOTAL_REVENUE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: float
              - positive
              - revenue_calculation
              - dbt_expectations.expect_column_sum_to_be_between:
                  min_value: 1
                  max_value: 10000000000
              - transaction_sum_test:
                  test_value: 1000000
                  test_year: 2010
          - name: TOTAL_COST
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: float
              - positive
          - name: TOTAL_PROFIT
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: float
          - name: DATE_DIFFERENCE
            description: column_test
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: number
              - positive

